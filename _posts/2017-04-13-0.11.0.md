---
title: "0.11.0"
category: New Release
---
- Version bump 0.11.0
- Merge pull request #165 from eclake/nebular_Z_set_Apr2017  Re-instigating changes introduced in pull request #163 after master and develop history fixed
- removing a renegade print and pause statement in dependent_parameters.f90
- minor edit to comment
- Changes to be able to set nebularZ and logU to DEFAULT_SP in dependent_parameters  If no mass formed in last 10^7 years, nebularZ and logU set to DEFAULT_SP if parameters set to dependent in parameter file.  This requires a couple of changes to make sure nebular emission parameters are allocated and assigned a suitable value (in nebular_emission.f90) . Also a small change in io_nebular_emission.f90 to make sure doesn’t try to calculate logOH if nebularZ not assigned.  Now values not set will appear in the output file as DEFAULT_SP values and any nebular lines and continuum are set to 0.
- Fixed two bugs  First in dependent_parameters.f90, I had forgotten to assign a value to logU in the first pass of setting dependent parameters (was previously incorporated in pull request #104)  Then in star_formation.f90, a change in how star formation bins are addressed since #104 was submitted meant that if I didn’t set sf%total_mass then the masses were renormalised to -99. (the default value for mass when not assigned in the parameter file).  I also assigned the bin mass based on the total mass if that wasn’t assigned from the parameter file although I’m not sure how SF bins would work when using user-supplied SFHs.  Also cleaned up some comments.
- Bug fixes found when trying to compile
- added max_mock_draws to BEAGLE.f90
- implementing suggested changes from Jacopo's comments on pull request #104  For now keeping default nebularZ as 0.017, to be changed when we find a way to handle the errors produced when nebularZ left unassigned. Otherwise tidying code as suggested in comments.
- changed when to set params in galaxy_SED for simulated SFHs  setting nebular_Z and logU before young stars nebular_Z is set (rather than after as it was before)
- Changed implementation of chem_abund resampling in star_formation.f90  Changing the requirement of reading in the mass-weighted chemical abundance only of stars formed in a given time step (rather than cumulative mass-weighted chemical abundance).
- addressing code review for pull request #104 plus minor bug fix  dependent metallicity set based on mass-weighted chem_abund in last 10Myr  removed print statements  Added checks in get_simulated_SF_ChE to make sure always ‘shifting’ to a real index as numerical inaccuracies can still cause problems here if not careful.  Added another check to ensure not dividing by zero mass (lines 913-917) although didn’t affect results.  Moved minimum chem_abund assignment in mass_weighted_cum_chem_to_bin_chem so that doesn’t effect calculation of other bin values.
- removed extraneous lines used for testing and updated comments
- removed linear interpolation between first two time steps  removed linear interpolation between first two time steps when shifting to observed redshift in get_simulated_SF_ChE. Instead the chem_abund per bin is calculated before shifting, and then sfr and chem_abund_bin are constant throughout bin and no interpolation necessary. Also added some checks in mass_weighted_cum_chem_to_bin_chem to handle numerical inaccuracies
- Changes to be able to set nebular_Z and nebular_logU dependent on stellar metallicity for mock photometry produced from simulated star formation histories  This requires setting nebular_Z and nebular_logU after the star formation history has been selected, meaning that it can’t be done at the ‘set_and_change_parameters’ stage.  I therefore added Z_par_type and logU_par_type to the emission_line_data type, so that if these parameters are set to ‘dependent’ in the parameter file, we can test this from galaxy%nebular%Z_par_type and set the values accordingly. The values are set with two new functions added to dependent_parameters.f90 - set_simulated_dependent_nebular_logU - set_simulated_dependent_nebular_Z  There were also minor tweaks required in set_dependent_parameter_Franx_May_2015 which is the currently implemented function for setting dependent parameter values.  These changes are required because metallicity shouldn’t be a named parameter in the parameter file when chosing the sfh_type:simulated option and so if it is not present, nebular_Z and nebular_logU are given placeholder values for now.  Have also included a print_warning statement incase this isn’t the desired behaviour of the user.
- Added while loop for drawing SFHs from file  Within BEAGLE.f90, set a while loop so that a new SFH is drawn until the parameters are valid.  One common reason they may not be valid is if the redshift of observation is higher than the formation redshift of the randomly drawn object.
- updated test_star_formation_rebin_semi_analytic_chem_abund
- Number of He ionizing photons was not computed when fitting observations, this modification should fix it
